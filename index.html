<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>VK Terminal — System Test</title>
  <link rel="stylesheet" href="main.css">
  <style>
    .test-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 20px;
      padding: 20px;
      height: calc(100vh - 160px);
    }
    .test-panel {
      background: #111;
      border: 2px solid #444;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    .test-panel h2 {
      position: absolute;
      top: 10px;
      left: 10px;
      margin: 0;
      font-size: 14px;
      color: #888;
    }
    .test-panel .status {
      font-size: 24px;
      color: #0f0;
    }
    .test-panel .status.offline {
      color: #f00;
    }
    .test-panel canvas {
      max-width: 100%;
      max-height: 80%;
    }
    .launcher {
      padding: 20px;
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .launcher a {
      display: inline-block;
      padding: 12px 24px;
      background: #222;
      border: 1px solid #666;
      color: #fff;
      text-decoration: none;
      font-size: 14px;
    }
    .launcher a:hover {
      background: #333;
      border-color: #888;
    }
    .header {
      padding: 20px;
      text-align: center;
      border-bottom: 1px solid #333;
    }
    .header h1 {
      margin: 0;
      font-size: 24px;
      color: #ffdd88;
    }
    .header p {
      margin: 8px 0 0;
      color: #888;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div id="themeRoot" class="theme-esper">
    <div class="header">
      <h1>VOIGHT-KAMPFF TERMINAL — SYSTEM TEST</h1>
      <p>Verify all displays are active before launching kiosk mode</p>
    </div>
    
    <div class="test-grid">
      <div class="test-panel" id="voiceTest">
        <h2>VOICE ANALYZER (GPIO LCD 1)</h2>
        <canvas id="voiceCanvas" width="400" height="400"></canvas>
        <div class="status" id="voiceStatus">CHECKING...</div>
      </div>
      
      <div class="test-panel" id="mainTest">
        <h2>MAIN DISPLAY (HDMI)</h2>
        <div id="irisScreen" style="width:100%;height:80%;background:#000;display:flex;align-items:center;justify-content:center;">
          <video id="irisVideo" autoplay muted playsinline style="width:100%;height:100%;object-fit:cover;display:none;"></video>
          <div id="irisBars" style="display:flex;align-items:center;justify-content:center;width:100%;height:100%;background:linear-gradient(to right,#fff 0 14%,#ff0 14% 28%,#0f0 28% 42%,#0ff 42% 56%,#00f 56% 70%,#f0f 70% 84%,#f00 84% 100%);">
            <span style="color:#000;font-size:2rem;">TYRELL CO.</span>
          </div>
        </div>
        <div class="status" id="mainStatus">CHECKING...</div>
      </div>
      
      <div class="test-panel" id="nexusTest">
        <h2>NEXUS PROBABILITY (GPIO LCD 2)</h2>
        <canvas id="nexusCanvas" width="400" height="400"></canvas>
        <div class="status" id="nexusStatus">CHECKING...</div>
      </div>
    </div>
    
    <div class="launcher">
      <a href="operator.html">LAUNCH OPERATOR (HDMI)</a>
      <a href="voice.html">LAUNCH VOICE (LCD 1)</a>
      <a href="nexus.html">LAUNCH NEXUS (LCD 2)</a>
      <a href="technician.html">TECHNICIAN ACCESS</a>
    </div>
  </div>
  
  <script src="js/shared.js"></script>
  <script src="js/voice.js"></script>
  <script src="js/nexus.js"></script>
  <script>
    // Test page initialization
    VoicePanel.init("voiceCanvas");
    NexusPanel.init("nexusCanvas");
    
    // Request token for camera/audio test
    document.getElementById("mainTest").addEventListener("click", async () => {
      const success = await VK.requestToken();
      if (success) {
        document.getElementById("irisVideo").srcObject = VK.mediaStream;
        document.getElementById("irisVideo").style.display = "block";
        document.getElementById("irisBars").style.display = "none";
        document.getElementById("mainStatus").textContent = "ACTIVE";
        document.getElementById("mainStatus").classList.remove("offline");
      }
    });
    
    // Mark panels as ready
    setTimeout(() => {
      document.getElementById("voiceStatus").textContent = "READY";
      document.getElementById("nexusStatus").textContent = "READY";
      document.getElementById("mainStatus").textContent = "CLICK TO TEST CAMERA";
    }, 500);
    
    // Animation loop for test display
    function testAnimate() {
      VoicePanel.draw();
      NexusPanel.draw();
      requestAnimationFrame(testAnimate);
    }
    testAnimate();
    
    // Load firmware
    VK.loadDefaultFirmware();
  </script>
</body>
</html>
